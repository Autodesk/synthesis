#!/bin/sh

install_appimaged() {
	mkdir -p ~/Applications
	wget -c https://github.com/$(wget -q https://github.com/probonopd/go-appimage/releases -O - | grep "appimaged-.*-x86_64.AppImage" | head -n 1 | cut -d '"' -f 2) -P ~/Applications/
	chmod +x ~/Applications/appimaged-*.AppImage
	
	# Launch
	~/Applications/appimaged-*.AppImage &
}

HERE="$(dirname "$(readlink -f "${0}")")"
EXEC="$HERE/usr/bin/Synthesis.x86_64"

mkdir -p ~/.config/Autodesk/Synthesis/Mira/Fields
cp "$HERE/fields/"*.mira ~/.config/Autodesk/Synthesis/Mira/Fields
cp "$HERE/robots/"*.mira ~/.config/Autodesk/Synthesis/Mira/

if [ ! -e ~/Applications/appimaged-*.AppImage ] 
then
  while true; do
		read -p "Do You wish to install and start appimaged? (recommended) [y/n] " yn
		case $yn in
			[Yy]* ) 
				install_appimaged;
				break
				;;
			[Nn]* )
				break
				;;
			* ) 
				echo "Please answer yes or no."
				;;
		esac
	done
fi

exec "$EXEC"
